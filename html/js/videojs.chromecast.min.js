(function(){var t={}.hasOwnProperty,e=function(e,i){function s(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return s.prototype=i.prototype,e.prototype=new s,e.__super__=i.prototype,e};vjs.addLanguage("de",{"CASTING TO":"WIEDERGABE AUF"}),vjs.addLanguage("it",{"CASTING TO":"PLAYBACK SU"}),vjs.plugin("chromecast",function(t){return this.chromecastComponent=new vjs.ChromecastComponent(this,t),this.controlBar.addChild(this.chromecastComponent)}),vjs.ChromecastComponent=function(t){function i(t,e){this.settings=e,i.__super__.constructor.call(this,t,e),t.controls()||this.disable(),this.hide(),this.initializeApi()}return e(i,t),i.prototype.buttonText="Chromecast",i.prototype.inactivityTimeout=2e3,i.prototype.apiInitialized=!1,i.prototype.apiSession=null,i.prototype.apiMedia=null,i.prototype.casting=!1,i.prototype.paused=!0,i.prototype.muted=!1,i.prototype.currentVolume=1,i.prototype.currentMediaTime=0,i.prototype.timer=null,i.prototype.timerStep=1e3,i.prototype.initializeApi=function(){var t,e,i;if(vjs.IS_CHROME)return chrome.cast&&chrome.cast.isAvailable?(vjs.log("Cast APIs are available"),e=this.settings.appId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,i=new chrome.cast.SessionRequest(e),t=new chrome.cast.ApiConfig(i,this.sessionJoinedListener,this.receiverListener.bind(this)),chrome.cast.initialize(t,this.onInitSuccess.bind(this),this.castError)):(vjs.log("Cast APIs not available. Retrying..."),void setTimeout(this.initializeApi.bind(this),1e3))},i.prototype.sessionJoinedListener=function(){return console.log("Session joined")},i.prototype.receiverListener=function(t){return"available"===t?this.show():void 0},i.prototype.onInitSuccess=function(){return this.apiInitialized=!0},i.prototype.castError=function(t){return vjs.log("Cast Error: "+JSON.stringify(t))},i.prototype.doLaunch=function(){return vjs.log("Cast video: "+this.player_.currentSrc()),this.apiInitialized?chrome.cast.requestSession(this.onSessionSuccess.bind(this),this.castError):vjs.log("Session not initialized")},i.prototype.onSessionSuccess=function(t){var e,i,s,r,o,n;if(vjs.log("Session initialized: "+t.sessionId),this.apiSession=t,this.addClass("connected"),r=new chrome.cast.media.MediaInfo(this.player_.currentSrc(),this.player_.currentType()),r.streamType=chrome.cast.media.StreamType.LIVE,this.settings.metadata){r.metadata=new chrome.cast.media.GenericMediaMetadata,n=this.settings.metadata;for(i in n)o=n[i],r.metadata[i]=o;this.player_.options_.poster&&(e=new chrome.cast.Image(this.player_.options_.poster),r.metadata.images=[e])}return s=new chrome.cast.media.LoadRequest(r),s.autoplay=!0,s.currentTime=this.player_.currentTime(),this.apiSession.loadMedia(s,this.onMediaDiscovered.bind(this),this.castError),this.apiSession.addUpdateListener(this.onSessionUpdate.bind(this))},i.prototype.onMediaDiscovered=function(t){return this.apiMedia=t,this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.startProgressTimer(this.incrementMediaTime.bind(this)),this.player_.loadTech("ChromecastTech",{receiver:this.apiSession.receiver.friendlyName}),this.casting=!0,this.paused=this.player_.paused(),this.inactivityTimeout=this.player_.options_.inactivityTimeout,this.player_.options_.inactivityTimeout=0,this.player_.userActive(!0)},i.prototype.onSessionUpdate=function(t){return this.apiMedia?t?void 0:this.onStopAppSuccess():void 0},i.prototype.onMediaStatusUpdate=function(){if(this.apiMedia)switch(this.currentMediaTime=this.apiMedia.currentTime,this.apiMedia.playerState){case chrome.cast.media.PlayerState.IDLE:return this.currentMediaTime=0,this.trigger("timeupdate"),this.onStopAppSuccess();case chrome.cast.media.PlayerState.PAUSED:if(this.paused)return;return this.player_.pause(),this.paused=!0;case chrome.cast.media.PlayerState.PLAYING:if(!this.paused)return;return this.player_.play(),this.paused=!1}},i.prototype.startProgressTimer=function(t){return this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(t.bind(this),this.timerStep)},i.prototype.play=function(){return this.apiMedia&&this.paused?(this.apiMedia.play(null,this.mediaCommandSuccessCallback.bind(this,"Playing: "+this.apiMedia.sessionId),this.onError),this.paused=!1):void 0},i.prototype.pause=function(){return this.apiMedia?this.paused?void 0:(this.apiMedia.pause(null,this.mediaCommandSuccessCallback.bind(this,"Paused: "+this.apiMedia.sessionId),this.onError),this.paused=!0):void 0},i.prototype.seekMedia=function(t){var e;return e=new chrome.cast.media.SeekRequest,e.currentTime=t,this.player_.controlBar.progressControl.seekBar.videoWasPlaying&&(e.resumeState=chrome.cast.media.ResumeState.PLAYBACK_START),this.apiMedia.seek(e,this.onSeekSuccess.bind(this,t),this.onError)},i.prototype.onSeekSuccess=function(t){return this.currentMediaTime=t},i.prototype.setMediaVolume=function(t,e){var i,s;if(this.apiMedia)return s=new chrome.cast.Volume,s.level=t,s.muted=e,this.currentVolume=s.level,this.muted=e,i=new chrome.cast.media.VolumeRequest,i.volume=s,this.apiMedia.setVolume(i,this.mediaCommandSuccessCallback.bind(this,"Volume changed"),this.onError),this.player_.trigger("volumechange")},i.prototype.incrementMediaTime=function(){return this.apiMedia.playerState===chrome.cast.media.PlayerState.PLAYING?this.currentMediaTime<this.apiMedia.media.duration?(this.currentMediaTime+=1,this.trigger("timeupdate")):(this.currentMediaTime=0,clearInterval(this.timer)):void 0},i.prototype.mediaCommandSuccessCallback=function(t){return vjs.log(t)},i.prototype.onError=function(){return vjs.log("error")},i.prototype.stopCasting=function(){return this.apiSession.stop(this.onStopAppSuccess.bind(this),this.onError)},i.prototype.onStopAppSuccess=function(){return clearInterval(this.timer),this.casting=!1,this.removeClass("connected"),this.player_.src(this.player_.options_.sources),this.paused||this.player_.one("seeked",function(){return this.player_.play()}),this.player_.currentTime(this.currentMediaTime),this.player_.tech.setControls(!1),this.player_.options_.inactivityTimeout=this.inactivityTimeout,this.apiMedia=null,this.apiSession=null},i.prototype.buildCSSClass=function(){return i.__super__.buildCSSClass.apply(this,arguments)+"vjs-chromecast-button"},i.prototype.onClick=function(){return i.__super__.onClick.apply(this,arguments),this.casting?this.stopCasting():this.doLaunch()},i}(vjs.Button),vjs.ChromecastTech=function(t){function i(t,e,s){this.featuresVolumeControl=!0,this.movingMediaElementInDOM=!1,this.featuresFullscreenResize=!1,this.featuresProgressEvents=!0,this.receiver=e.source.receiver,i.__super__.constructor.call(this,t,e,s),this.triggerReady()}return e(i,t),i.isSupported=function(){return this.player_.chromecastComponent.apiInitialized},i.canPlaySource=function(t){return"video/mp4"===t.type||"video/webm"===t.type||"application/x-mpegURL"===t.type||"application/vnd.apple.mpegURL"===t.type},i.prototype.createEl=function(){var t;return t=document.createElement("div"),t.id=""+this.player_.id_+"_chromecast_api",t.className="vjs-tech vjs-tech-chromecast",t.innerHTML='<div class="casting-image" style="background-image: url(\''+this.player_.options_.poster+'\')"></div>\n<div class="casting-overlay">\n  <div class="casting-information">\n    <div class="casting-icon">&#58880</div>\n    <div class="casting-description"><small>'+this.localize("CASTING TO")+"</small><br>"+this.receiver+"</div>\n  </div>\n</div>",t.player=this.player_,vjs.insertFirst(t,this.player_.el()),t},i.prototype.play=function(){return this.player_.chromecastComponent.play(),this.player_.onPlay()},i.prototype.pause=function(){return this.player_.chromecastComponent.pause(),this.player_.onPause()},i.prototype.paused=function(){return this.player_.chromecastComponent.paused},i.prototype.currentTime=function(){return this.player_.chromecastComponent.currentMediaTime},i.prototype.setCurrentTime=function(t){return this.player_.chromecastComponent.seekMedia(t)},i.prototype.volume=function(){return this.player_.chromecastComponent.currentVolume},i.prototype.setVolume=function(t){return this.player_.chromecastComponent.setMediaVolume(t,!1)},i.prototype.muted=function(){return this.player_.chromecastComponent.muted},i.prototype.setMuted=function(t){return this.player_.chromecastComponent.setMediaVolume(this.player_.chromecastComponent.currentVolume,t)},i.prototype.supportsFullScreen=function(){return!1},i}(vjs.MediaTechController)}).call(this);
